<!-- HEADER SUPERIOR -->
<div class="header">
  <div class="header-left">
    <div class="titulo">Notificaciones</div>
  </div>
  <div class="header-right">
    <button class="profile-btn" (click)="openProfileMenu($event)">
      <img *ngIf="userProfileImage" [src]="userProfileImage" alt="Perfil" class="profile-img">
      <ion-icon *ngIf="!userProfileImage" name="person-circle" class="profile-icon"></ion-icon>
    </button>
  </div>
</div>

<div id="tab1-content">
  <ion-content class="fondo" [fullscreen]="true">

  <!-- APARTADO DE PULSO EN TIEMPO REAL -->
  <div class="pulso-monitor" *ngIf="currentBpm !== null">
    <div class="pulso-card">
      <div class="pulso-icon">
        <ion-icon name="heart" [class.pulsing]="currentBpm > 0"></ion-icon>
      </div>
      <div class="pulso-info">
        <div class="pulso-label">Pulso en tiempo real</div>
        <div class="pulso-valor">
          <span class="bpm-number">{{ currentBpm }}</span>
          <span class="bpm-unit">BPM</span>
        </div>
        <div class="pulso-adulto" *ngIf="currentAdultoName">{{ currentAdultoName }}</div>
      </div>
    </div>
  </div>

  <!-- FILTROS -->
  <ion-segment class="filtros" [value]="filtroActivo" (ionChange)="setFiltro($event.detail.value)">
    <ion-segment-button value="todas">
      <ion-label>Todas</ion-label>
    </ion-segment-button>
    <ion-segment-button value="emergencia">
      <ion-label>Emergencias</ion-label>
    </ion-segment-button>
    <ion-segment-button value="ayuda">
      <ion-label>Ayuda</ion-label>
    </ion-segment-button>
  </ion-segment>

  <!-- LISTA DE NOTIFICACIONES -->
  <div class="lista">
    <!-- Loading -->
    <div *ngIf="isLoading" class="loading-container">
      <ion-spinner name="crescent"></ion-spinner>
      <p>Cargando notificaciones...</p>
    </div>

    <!-- Mostrar notificaciones filtradas -->
    <ng-container *ngIf="!isLoading && notificacionesFiltradas.length > 0">
      <div *ngFor="let noti of notificacionesFiltradas; let i = index" 
           [ngClass]="['noti', noti.tipo]" 
           (click)="marcarLeida(i)">
        <div class="noti-header">
          <div class="noti-info">
            <div class="noti-titulo">
              <span [ngClass]="['badge', noti.tipo + '-badge']">
                {{ noti.tipo === 'emergencia' ? 'Emergencia' : noti.tipo === 'ayuda' ? 'Botón de Ayuda' : 'Ayuda' }}
              </span>
              <span *ngIf="noti.isShared" class="shared-badge" title="Dispositivo compartido">
                <ion-icon name="share-social"></ion-icon>
              </span>
              <span class="tiempo">{{ noti.tiempo }}</span>
            </div>
            <div class="usuario">{{ noti.usuario }}</div>
          </div>
        </div>
        <div class="noti-contenido">
          <div class="descripcion">{{ noti.descripcion }}</div>
        </div>
      </div>
    </ng-container>

    <!-- Estado vacío -->
    <div *ngIf="!isLoading && notificacionesFiltradas.length === 0" class="estado-vacio">
      <ion-icon name="notifications-off-outline"></ion-icon>
      <p>No hay notificaciones</p>
      <span>Cuando recibas notificaciones aparecerán aquí</span>
    </div>
  </div>

</ion-content>
</div>