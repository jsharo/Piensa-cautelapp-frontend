<div class="modal-wrapper">
  <div class="modal-header">
    <h2>
      <ion-icon [name]="editingAlarm ? 'pencil-outline' : 'alarm-outline'"></ion-icon>
      {{ editingAlarm ? 'Editar alarma' : 'Nueva alarma' }}
    </h2>
    <button class="btn-save" (click)="saveAlarm()">
      <ion-icon name="checkmark-circle"></ion-icon>
      Guardar
    </button>
    <button class="btn-close" (click)="dismiss()">
      <ion-icon name="close-outline"></ion-icon>
    </button>
  </div>

  <div class="modal-content">
    <!-- Selector de Hora Mejorado -->
    <div class="time-picker-section">
      <div class="section-header">
        <ion-icon name="time-outline" class="section-icon"></ion-icon>
        <label class="section-label-main">Hora de la alarma</label>
      </div>
      <ion-datetime 
        presentation="time" 
        [(ngModel)]="newAlarmTime" 
        [preferWheel]="true"
        class="custom-datetime"
        [hourCycle]="'h23'"
        locale="es-ES"
      ></ion-datetime>
    </div>

    <!-- Título Mejorado -->
    <div class="input-section enhanced">
      <div class="section-header">
        <ion-icon name="text-outline" class="section-icon"></ion-icon>
        <label class="section-label-main">Título</label>
      </div>
      <ion-item class="custom-input enhanced" lines="none">
        <ion-input 
          type="text" 
          [(ngModel)]="newAlarmLabel" 
          placeholder="Ej. Tomar aspirina"
          class="enhanced-input"
        ></ion-input>
      </ion-item>
    </div>

    <!-- Categoría Mejorada -->
    <div class="input-section enhanced">
      <div class="section-header">
        <ion-icon name="pricetag-outline" class="section-icon"></ion-icon>
        <label class="section-label-main">Categoría</label>
      </div>
      <div class="category-selector enhanced">
        <button class="category-btn enhanced" [class.selected]="newAlarmCategory === 'medicamento'"
          (click)="newAlarmCategory = 'medicamento'">
          <div class="category-icon medicamento">
            <ion-icon name="medical-outline"></ion-icon>
          </div>
          <span>Medicamento</span>
        </button>
        <button class="category-btn enhanced" [class.selected]="newAlarmCategory === 'cita'"
          (click)="newAlarmCategory = 'cita'">
          <div class="category-icon cita">
            <ion-icon name="calendar-outline"></ion-icon>
          </div>
          <span>Cita médica</span>
        </button>
        <button class="category-btn enhanced" [class.selected]="newAlarmCategory === 'otro'"
          (click)="newAlarmCategory = 'otro'">
          <div class="category-icon otro">
            <ion-icon name="notifications-outline"></ion-icon>
          </div>
          <span>Otro</span>
        </button>
      </div>
    </div>

    <!-- Días de repetición Mejorados -->
    <div class="input-section enhanced">
      <div class="section-header">
        <ion-icon name="repeat-outline" class="section-icon"></ion-icon>
        <label class="section-label-main">Repetir</label>
        <span class="days-count" *ngIf="newAlarmRepeatDays.length > 0">
          {{ newAlarmRepeatDays.length }} {{ newAlarmRepeatDays.length === 1 ? 'día' : 'días' }}
        </span>
      </div>
      <div class="days-selector enhanced">
        <button *ngFor="let day of daysOfWeek" class="day-btn enhanced" [class.selected]="isDaySelected(day.value)"
          (click)="toggleDay(day.value)">
          <span class="day-letter">{{ day.label }}</span>
        </button>
      </div>
    </div>

    <!-- Notas adicionales Mejoradas -->
    <div class="input-section enhanced">
      <div class="section-header">
        <ion-icon name="document-text-outline" class="section-icon"></ion-icon>
        <label class="section-label-main">Notas (opcional)</label>
      </div>
      <ion-item class="custom-input enhanced textarea" lines="none">
        <ion-input 
          type="text" 
          [(ngModel)]="newAlarmNotes" 
          placeholder="Ej. Después de comer, con agua"
          class="enhanced-input"
        ></ion-input>
      </ion-item>
    </div>

    <!-- Preview Card -->
    <div class="alarm-preview-card" *ngIf="newAlarmLabel">
      <div class="preview-header">
        <ion-icon name="eye-outline"></ion-icon>
        <span>Vista previa</span>
      </div>
      <div class="preview-content">
        <div class="preview-icon" [attr.data-category]="newAlarmCategory">
          <ion-icon [name]="getCategoryIcon(newAlarmCategory)"></ion-icon>
        </div>
        <div class="preview-info">
          <div class="preview-time">{{ formatTime(newAlarmTime) }}</div>
          <div class="preview-label">{{ newAlarmLabel }}</div>
          <div class="preview-days" *ngIf="newAlarmRepeatDays.length > 0">
            <span class="preview-day-badge" *ngFor="let day of newAlarmRepeatDays">{{ getDayAbbr(day) }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
