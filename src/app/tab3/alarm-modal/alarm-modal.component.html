<div class="modal-wrapper">
  <div class="modal-header">
    <h2>
      <lucide-icon [img]="editingAlarm ? Pencil : AlarmClock" [size]="20"></lucide-icon>
      {{ editingAlarm ? 'Editar alarma' : 'Nueva alarma' }}
    </h2>
    <button class="btn-save" (click)="saveAlarm()">
      <lucide-icon [img]="CheckCircle" [size]="18"></lucide-icon>
      Guardar
    </button>
    <button class="btn-close" (click)="dismiss()">
      <lucide-icon [img]="X" [size]="18"></lucide-icon>
    </button>
  </div>

  <div class="modal-content">
    <!-- Selector de Hora Mejorado -->
    <div class="time-picker-section">
      <div class="section-header">
        <lucide-icon [img]="Clock" [size]="18" class="section-icon"></lucide-icon>
        <label class="section-label-main">Hora de la alarma</label>
      </div>
      <ion-datetime 
        presentation="time" 
        [(ngModel)]="newAlarmTime"
        (ionChange)="onTimeChange($event)"
        [preferWheel]="true"
        class="custom-datetime"
        [hourCycle]="'h23'"
        locale="es-ES"
      ></ion-datetime>
    </div>

    <!-- Título Mejorado -->
    <div class="input-section enhanced">
      <div class="section-header">
        <lucide-icon [img]="Type" [size]="18" class="section-icon"></lucide-icon>
        <label class="section-label-main">Título</label>
      </div>
      <ion-item class="custom-input enhanced" lines="none">
        <ion-input 
          type="text" 
          [(ngModel)]="newAlarmLabel"
          (ionInput)="onLabelChange($event)"
          placeholder="Ej. Tomar aspirina"
          class="enhanced-input"
          [clearInput]="true"
        ></ion-input>
      </ion-item>
    </div>

    <!-- Categoría Mejorada -->
    <div class="input-section enhanced">
      <div class="section-header">
        <lucide-icon [img]="Tag" [size]="18" class="section-icon"></lucide-icon>
        <label class="section-label-main">Categoría</label>
      </div>
      <div class="category-selector enhanced">
        <button class="category-btn enhanced" [class.selected]="newAlarmCategory === 'medicamento'"
          (click)="newAlarmCategory = 'medicamento'">
          <div class="category-icon medicamento">
            <lucide-icon [img]="Pill" [size]="20"></lucide-icon>
          </div>
          <span>Medicamento</span>
        </button>
        <button class="category-btn enhanced" [class.selected]="newAlarmCategory === 'cita'"
          (click)="newAlarmCategory = 'cita'">
          <div class="category-icon cita">
            <lucide-icon [img]="Calendar" [size]="20"></lucide-icon>
          </div>
          <span>Cita médica</span>
        </button>
        <button class="category-btn enhanced" [class.selected]="newAlarmCategory === 'otro'"
          (click)="newAlarmCategory = 'otro'">
          <div class="category-icon otro">
            <lucide-icon [img]="Bell" [size]="20"></lucide-icon>
          </div>
          <span>Otro</span>
        </button>
      </div>
    </div>

    <!-- Días de repetición Mejorados -->
    <div class="input-section enhanced">
      <div class="section-header">
        <lucide-icon [img]="Repeat" [size]="18" class="section-icon"></lucide-icon>
        <label class="section-label-main">Repetir</label>
        <span class="days-count" *ngIf="newAlarmRepeatDays.length > 0">
          {{ newAlarmRepeatDays.length }} {{ newAlarmRepeatDays.length === 1 ? 'día' : 'días' }}
        </span>
      </div>
      <div class="days-selector enhanced">
        <button *ngFor="let day of daysOfWeek" class="day-btn enhanced" [class.selected]="isDaySelected(day.value)"
          (click)="toggleDay(day.value)">
          <span class="day-letter">{{ day.label }}</span>
        </button>
      </div>
    </div>

    <!-- Notas adicionales Mejoradas -->
    <div class="input-section enhanced">
      <div class="section-header">
        <lucide-icon [img]="FileText" [size]="18" class="section-icon"></lucide-icon>
        <label class="section-label-main">Notas (opcional)</label>
      </div>
      <ion-item class="custom-input enhanced textarea" lines="none">
        <ion-input 
          type="text" 
          [(ngModel)]="newAlarmNotes" 
          placeholder="Ej. Después de comer, con agua"
          class="enhanced-input"
        ></ion-input>
      </ion-item>
    </div>

    <!-- Preview Card -->
    <div class="alarm-preview-card" *ngIf="newAlarmLabel">
      <div class="preview-header">
        <lucide-icon [img]="Eye" [size]="16"></lucide-icon>
        <span>Vista previa</span>
      </div>
      <div class="preview-content">
        <div class="preview-icon" [attr.data-category]="newAlarmCategory">
          <lucide-icon [img]="getCategoryIcon(newAlarmCategory)" [size]="24"></lucide-icon>
        </div>
        <div class="preview-info">
          <div class="preview-time">{{ formatTime(newAlarmTime) }}</div>
          <div class="preview-label">{{ newAlarmLabel }}</div>
          <div class="preview-days" *ngIf="newAlarmRepeatDays.length > 0">
            <span class="preview-day-badge" *ngFor="let day of newAlarmRepeatDays">{{ getDayAbbr(day) }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
